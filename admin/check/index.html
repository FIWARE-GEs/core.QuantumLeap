<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  
  <link rel="shortcut icon" href="../../img/favicon.ico">
  <title>Sanity Check - QuantumLeap</title>
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  <link rel="stylesheet" href="../../css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../css/theme_extra.css" type="text/css" />
  <link rel="stylesheet" href="../../css/highlight.css">
  <link href="https://fiware.org/style/fiware_readthedocs.css" rel="stylesheet">
  
  <script>
    // Current page data
    var mkdocs_page_name = "Sanity Check";
    var mkdocs_page_input_path = "admin/check.md";
    var mkdocs_page_url = "/admin/check/";
  </script>
  
  <script src="../../js/jquery-2.1.1.min.js"></script>
  <script src="../../js/modernizr-2.8.3.min.js"></script>
  <script type="text/javascript" src="../../js/highlight.pack.js"></script> 
  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
      <div class="wy-side-nav-search">
        <a href="../.." class="icon icon-home"> QuantumLeap</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
	<ul class="current">
	  
          
            <li class="toctree-l1">
		
    <a class="" href="../..">Home</a>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">User & Programmers Manual</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../../user/">Introduction</a>
                </li>
                <li class="">
                    
    <a class="" href="../../user/troubleshooting/">Troubleshooting</a>
                </li>
                <li class="">
                    
    <a class="" href="../../user/contributing/">Contributing</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Installation & Administration Manual</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../">Introduction</a>
                </li>
                <li class=" current">
                    
    <a class="current" href="./">Sanity Check</a>
    <ul class="subnav">
            
    <li class="toctree-l3"><a href="#sanity-check">Sanity Check</a></li>
    
        <ul>
        
            <li><a class="toctree-l4" href="#manual-sanity-check">Manual Sanity Check</a></li>
        
            <li><a class="toctree-l4" href="#automated-sanity-check">Automated Sanity Check</a></li>
        
        </ul>
    

    </ul>
                </li>
                <li class="">
                    
    <a class="" href="../ports/">Ports</a>
                </li>
                <li class="">
                    
    <a class="" href="../crate/">Crate</a>
                </li>
                <li class="">
                    
    <a class="" href="../grafana/">Grafana</a>
                </li>
    </ul>
	    </li>
          
        </ul>
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../..">QuantumLeap</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../..">Docs</a> &raquo;</li>
    
      
        
          <li>Installation & Administration Manual &raquo;</li>
        
      
    
    <li>Sanity Check</li>
    <li class="wy-breadcrumbs-aside">
      
        <a href="https://github.com/smartsdk/ngsi-timeseries-api.git/edit/master/docs/admin/check.md"
          class="icon icon-github"> Edit on GitHub</a>
      
    </li>
  </ul>
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <h1 id="sanity-check">Sanity Check</h1>
<p>To make sure your deployment of QuantumLeap is complete and well functioning,
you can follow any of these sanity checks.</p>
<p>The instructions assume a local docker-based deployment with the ports mapped to
localhost. But of course, you will need to update the IP addresses of the
services accordingly to suit your deployment.</p>
<h2 id="manual-sanity-check">Manual Sanity Check</h2>
<p>Following the process manually can help you get acquainted with the flow. To
assist you, you can use the <em>Orion</em> and <em>QuantumLeap</em> requests in <a href="https://raw.githubusercontent.com/smartsdk/smartsdk-recipes/master/recipes/tools/postman_collection.json">this postman collection</a>.
If you don't use Postman, you can use the equivalent curl commands bellow.</p>
<ol>
<li>
<p>Check you can get <em>Orion version</em></p>
<pre><code>curl -X GET http://0.0.0.0:1026/version -H 'Accept: application/json'
</code></pre>
<p>You should get a return status <code>200 OK</code>.</p>
</li>
<li>
<p>Check you can get <em>QuantumLeap version</em></p>
<pre><code>curl -X GET http://0.0.0.0:8668/v2/version -H 'Accept: application/json'
</code></pre>
<p>You should get a return status <code>200 OK</code>.</p>
</li>
<li>
<p>Create an Orion Subscription via "QuantumLeap Subscribe"
        curl -X POST \
        'http://0.0.0.0:8668/v2/subscribe?orionUrl=http://orion:1026/v2&amp;quantumleapUrl=http://quantumleap:8668/v2&amp;entityType=AirQualityObserved' \
        -H 'Accept: application/json'</p>
<p>Note we've just created a subscription for any change in any attribute of
entities of type <a href="https://github.com/Fiware/dataModels/tree/master/Environment/AirQualityObserved">AirQualityObserved</a></p>
<p>You should get a return status <code>201 Created</code>.</p>
</li>
<li>
<p>Check you cat get such subscription from Orion</p>
<pre><code>curl -X GET http://0.0.0.0:1026/v2/subscriptions \
-H 'Accept: application/json'
</code></pre>
<p>You should get a return status <code>200 OK</code>.</p>
</li>
<li>
<p>Insert an entity of AirQualityObserved into Orion</p>
<pre><code>curl -X POST \
'http://0.0.0.0:1026/v2/entities?options=keyValues' \
-H 'Accept: application/json' \
-H 'Content-Type: application/json' \
-d '{
"id": "air_quality_observer_be_001",
"type": "AirQualityObserved",
"address": {
"streetAddress": "IJzerlaan",
"postOfficeBoxNumber": "18",
"addressLocality": "Antwerpen",
"addressCountry": "BE"
},
"dateObserved": "2017-11-03T12:37:23.734827",
"source": "http://testing.data.from.smartsdk",
"precipitation": 0,
"relativeHumidity": 0.54,
"temperature": 12.2,
"windDirection": 186,
"windSpeed": 0.64,
"airQualityLevel": "moderate",
"airQualityIndex": 65,
"reliability": 0.7,
"CO": 500,
"NO": 45,
"NO2": 69,
"NOx": 139,
"SO2": 11,
"CO_Level": "moderate",
"refPointOfInterest": "null"
}'
</code></pre>
<p>You should get a return status <code>201 Created</code>.</p>
<p>Note we used <code>options=keyValues</code> for simplification just because this is a
sanity check. If you use such option in practice, you may loose translation capabilities as explained in the <a href="../../user/#orion-subscription">user guide</a>.</p>
</li>
<li>
<p>Update the precipitation value of the same entity in Orion.</p>
<pre><code>curl -X PATCH \
http://0.0.0.0:1026/v2/entities/air_quality_observer_be_001/attrs \
-H 'Accept: application/json' \
-H 'Content-Type: application/json' \
-d '{
"precipitation": {
"value": 100,
"type": "Number"
}
}'
</code></pre>
<p>You should get a return status <code>204 No Content</code>.</p>
</li>
<li>
<p>Query again historical records of precipitation for the same entity (1T1E1A).</p>
<pre><code>curl -X GET \
'http://0.0.0.0:8668/v2/entities/air_quality_observer_be_001/attrs/precipitation?type=AirQualityObserved' \
-H 'Accept: application/json'
</code></pre>
<p>You should get a return status <code>200 OK</code>, plus the historical records in the
response body.</p>
</li>
<li>
<p>Finally, to tidy things up, you can delete all created records.</p>
<p>Delete records from QL</p>
<pre><code>curl -X DELETE http://0.0.0.0:8668/v2/types/AirQualityObserved
</code></pre>
<p>Delete entity from Orion</p>
<pre><code>curl -X DELETE \
http://0.0.0.0:1026/v2/entities/air_quality_observer_be_001 \
-H 'Accept: application/json'
</code></pre>
<p>Delete subscription from Orion (replace the <code>id</code> with yours)</p>
<pre><code>curl -X DELETE \
http://0.0.0.0:1026/v2/subscriptions/5b3df2ae940fcc446763ef90 \
-H 'Accept: application/json'
</code></pre>
</li>
</ol>
<h2 id="automated-sanity-check">Automated Sanity Check</h2>
<p>If you are already familiar with the flow and just want a quick way to check
the essential services are correctly deployed, you can make use of one of the
integration tests that checks exactly this connection among core components.</p>
<p><em>IMPORTANT:</em> It is not suggested to run this script in production deployments
with valuable data. If things go wrong in the test, it may leave garbage data
or can lead to data loses. As always, use automation with caution.</p>
<p>You can see the test script <a href="https://github.com/smartsdk/ngsi-timeseries-api/blob/master/tests/test_integration.py">here</a>.
Pay attention to the input variables that, depending on your deployment, you
may need to configure. These indicate the URLs where to find the core services.
By default, it assumes all services run in a local docker-based deployment.</p>
<p>You can quickly execute the test in a container as shown below. You will have to
adjust, of course, the urls so that they point to your deployed services. In
the following example, ORION and QL are reachable by the test container at
<code>192.0.0.1</code> and then, by default, ORION and QL find each other at <code>orion</code> and
<code>quantumleap</code> endpoints because both were deployed in the same docker network.</p>
<pre><code>docker run -ti --rm -e ORION_URL=&quot;http://192.0.0.1:1026&quot; -e QL_URL=&quot;http://192.0.0.1:8668&quot; quantumleap pytest tests/test_integration.py
</code></pre>

<p>Or, assuming all services are in the same docker deployment and you have access
to it, you can run the test container in the same network so as to use the
service names in the urls.</p>
<pre><code>docker run -ti --rm --network docker_default -e ORION_URL=&quot;http://orion:1026&quot; -e QL_URL=&quot;http://quantumleap:8668&quot; quantumleap pytest tests/test_integration.py
</code></pre>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../ports/" class="btn btn-neutral float-right" title="Ports">Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="../" class="btn btn-neutral" title="Introduction"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
  </div>

  Built with <a href="http://www.mkdocs.org">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
      
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" style="cursor: pointer">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
          <a href="https://github.com/smartsdk/ngsi-timeseries-api.git/" class="fa fa-github" style="float: left; color: #fcfcfc"> GitHub</a>
      
      
        <span><a href="../" style="color: #fcfcfc;">&laquo; Previous</a></span>
      
      
        <span style="margin-left: 15px"><a href="../ports/" style="color: #fcfcfc">Next &raquo;</a></span>
      
    </span>
</div>
    <script>var base_url = '../..';</script>
    <script src="../../js/theme.js"></script>
      <script src="../../search/require.js"></script>
      <script src="../../search/search.js"></script>

</body>
</html>
